// This is your Prisma schema file
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(uuid())
  email        String    @unique @db.VarChar(255)
  passwordHash String    @map("password_hash") @db.VarChar(255)
  fullName     String    @map("full_name") @db.VarChar(255)
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  
  profile      UserProfile?
  dailySteps   DailySteps[]
  meals        Meal[]
  nutritionGoals NutritionGoals?

  @@index([email])
  @@map("users")
}

model DailySteps {
  id              String   @id @default(uuid())
  userId          String   @map("user_id")
  date            DateTime @db.Date
  steps           Int      @default(0)
  distanceKm      Decimal? @map("distance_km") @db.Decimal(6, 2)
  caloriesBurned  Int?     @map("calories_burned")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, date])
  @@index([userId, date])
  @@map("daily_steps")
}

model UserProfile {
  id                 String            @id @default(uuid())
  userId             String            @unique @map("user_id")
  dateOfBirth        DateTime?         @map("date_of_birth") @db.Date
  gender             Gender?
  heightCm           Decimal?          @map("height_cm") @db.Decimal(5, 2)
  currentWeightKg    Decimal?          @map("current_weight_kg") @db.Decimal(5, 2)
  targetWeightKg     Decimal?          @map("target_weight_kg") @db.Decimal(5, 2)
  fitnessGoal        FitnessGoal       @map("fitness_goal")
  activityLevel      ActivityLevel     @map("activity_level")
  dietaryPreference  DietaryPreference? @map("dietary_preference")
  createdAt          DateTime          @default(now()) @map("created_at")
  updatedAt          DateTime          @updatedAt @map("updated_at")
  
  user               User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("user_profiles")
}

// ===== MEAL TRACKING MODELS =====

model Meal {
  id              String      @id @default(uuid())
  userId          String      @map("user_id")
  mealType        MealType    @map("meal_type")
  date            DateTime    @db.Date
  totalCalories   Float       @map("total_calories")
  totalProtein    Float       @map("total_protein")
  totalCarbs      Float       @map("total_carbs")
  totalFat        Float       @map("total_fat")
  notes           String?     @db.Text
  createdAt       DateTime    @default(now()) @map("created_at")
  updatedAt       DateTime    @updatedAt @map("updated_at")
  
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  foods           MealFood[]
  
  @@index([userId, date])
  @@map("meals")
}

model MealFood {
  id              String   @id @default(uuid())
  mealId          String   @map("meal_id")
  foodId          String?  @map("food_id")
  foodName        String   @map("food_name")
  brandName       String?  @map("brand_name")
  servingSize     Float    @map("serving_size")
  servingUnit     String   @map("serving_unit")
  calories        Float
  protein         Float
  carbs           Float
  fat             Float
  createdAt       DateTime @default(now()) @map("created_at")
  
  meal            Meal     @relation(fields: [mealId], references: [id], onDelete: Cascade)
  
  @@index([mealId])
  @@map("meal_foods")
}

model NutritionGoals {
  id              String   @id @default(uuid())
  userId          String   @unique @map("user_id")
  dailyCalories   Int      @map("daily_calories") @default(2000)
  dailyProtein    Float    @map("daily_protein") @default(150)
  dailyCarbs      Float    @map("daily_carbs") @default(250)
  dailyFat        Float    @map("daily_fat") @default(65)
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")
  
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("nutrition_goals")
}

model FoodCache {
  id              String   @id @default(uuid())
  foodId          String   @unique @map("food_id")
  foodName        String   @map("food_name")
  brandName       String?  @map("brand_name")
  foodData        Json     @map("food_data")
  searchTerms     String   @map("search_terms") @db.Text
  cachedAt        DateTime @default(now()) @map("cached_at")
  expiresAt       DateTime @map("expires_at")
  
  @@index([foodName])
  @@map("food_cache")
}

// ===== ENUMS =====

enum MealType {
  breakfast
  lunch
  dinner
  snack
}

enum Gender {
  male
  female
  other
  prefer_not_to_say
}

enum FitnessGoal {
  lose_weight
  gain_muscle
  maintain
  get_fit
}

enum ActivityLevel {
  sedentary
  light
  moderate
  active
  very_active
}

enum DietaryPreference {
  none
  vegetarian
  vegan
  keto
  paleo
  halal
}
